import{a4 as C,a5 as u}from"./_applist-471.js";import{_ as n}from"./main-rotten-forks-end.js";import{s as r}from"./machine.-560.js";import{f as c,h as l,a as d,c as h,e as m}from"./mailchim-942.js";import"./lodash-670.js";import"./mutative-854.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(i,e){return this.cache.has(i)?this.cache.get(i):(this.cache.set(i,e),e)}};const I=C(({helpers:i})=>({states:{components:[{componentName:i.componentName.webhook,extraComponents:[h(i),{allowClear:!0,componentName:i.componentName.select,helperText:n("Choose the list to which you want to add a webhook."),id:"select-audience",label:n("Select Audience List"),onChange:"HANDLE_SELECT_AUDIENCE",onRefetch:"REFETCH_AUDIENCE_LIST",options:[],path:"select-audience",render:"IF_CONNECTION_SELECTED",value:void 0},{componentName:i.componentName.select,helperText:n("Select the type of Mailchimp Event that should trigger the webhook."),id:"select-webhook-event",label:n("Select Webhook Event"),onChange:"HANDLE_WEBHOOK_EVENT",options:[{label:n("SUBSCRIBE"),value:"subscribe"},{label:n("UNSUBSCRIBE"),value:"unsubscribe"},{label:n("PROFILE UPDATE"),value:"profile"},{label:n("CLEANED"),value:"cleaned"},{label:n("EMAIL_UPDATE"),value:"upemail"},{label:n("CAMPAIGN"),value:"campaign"}],render:"IF_AUDIENCE_LIST_SELECTED",value:void 0},{componentName:i.componentName.select,helperText:n("Select the Source of the event that should trigger the webhook."),id:"select-webhook-source",label:n("Select Webhook Source"),onChange:"HANDLE_WEBHOOK_SOURCE",options:[{label:n("USER"),value:"user"},{label:n("ADMIN"),value:"admin"},{label:n("API"),value:"api"}],render:"IF_AUDIENCE_LIST_SELECTED",value:void 0}],fieldType:"config",id:"webhook-id",label:n("Webhook"),onSave:"CLEAR_WEBHOOK_FORM_VALUES",onValidate:"HANDLE_VALIDATION",onWebhookChange:"SET_WEBHOOK",render:!0},{componentName:i.componentName.note,fieldType:"config",id:"note-id",label:n("Note"),note:[],render:!1}]},actions:{IF_AUDIENCE_LIST_SELECTED:({$:e})=>{var o,t;return u((o=e.getComponent("connection-id"))==null?void 0:o.value)&&((t=e.getComponent("select-audience"))==null?void 0:t.value)},SET_WEBHOOK:async({$:e,e:o})=>{l("webhookId")({$:e,e:o.id}),await c(e)},SET_CONNECTION:async({$:e,e:o})=>{l("connectionId")({$:e,e:o}),await c(e)},HANDLE_VALIDATION:({$:e})=>{var o,t,s,E;if(!((o=e.getComponent("connection-id"))!=null&&o.value))return e.setComponent("connection-id",a=>{e.util.isConnectionComponent(a)&&(a.status="error",a.invalidMessage="Please select a connection")}),!1;if(!((t=e.getComponent("select-audience"))!=null&&t.value))return e.setComponent("select-audience",a=>{e.util.isSelectComponent(a)&&(a.status="error",a.invalidMessage="Please select Audience List")}),!1;if(!((s=e.getComponent("select-webhook-event"))!=null&&s.value))return e.setComponent("select-webhook-event",a=>{e.util.isSelectComponent(a)&&(a.status="error",a.invalidMessage="Please select a Webhook Event")}),!1;if(!((E=e.getComponent("select-webhook-source"))!=null&&E.value))return e.setComponent("select-webhook-source",a=>{e.util.isSelectComponent(a)&&(a.status="error",a.invalidMessage="Please select a Webhook Source")}),!1},CLEAR_WEBHOOK_FORM_VALUES:async({$:e,e:o})=>{await m(e,o.url),e.setComponent("connection-id",t=>{e.util.isConnectionComponent(t)&&(t.value=void 0)}),e.setComponent("select-audience",t=>{e.util.isSelectComponent(t)&&(t.value=void 0)}),e.setComponent("select-webhook-event",t=>{e.util.isSelectComponent(t)&&(t.value=void 0)}),e.setComponent("select-webhook-source",t=>{e.util.isSelectComponent(t)&&(t.value=void 0)})},CONNECTION_ADD_CHANGE:d,HANDLE_SELECT_AUDIENCE:l("audienceList"),HANDLE_WEBHOOK_EVENT:l("webhookEvent"),HANDLE_WEBHOOK_SOURCE:l("webhookSource"),IF_CONNECTION_SELECTED:({$:e})=>{var o;return u((o=e.getComponent("connection-id"))==null?void 0:o.value)},REFETCH_AUDIENCE_LIST:async({$:e})=>await c(e),ON_MACHINE_LOAD:async({$:e})=>{var o;r(e,[{db:"webhookId",id:"webhook-id"},{db:"audienceList",id:"select-audience"},{db:"webhookEvent",id:"select-webhook-event"},{db:"webhookSource",id:"select-webhook-source"}]),(o=e.db)!=null&&o.connectionId&&await c(e)}}}));export{I as default};

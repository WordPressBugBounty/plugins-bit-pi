import{h as oe,q as ie,au as G,w as B,ax as Y,d as re,r as R,C as J,a as N,j as a,aN as le,y as L,B as S,_ as b,d8 as fe,S as ge,ba as pe,R as Ce,aY as U,d9 as ke,F as K,af as V,aw as ye,s as we,m as F,da as Ae,cg as Te}from"./main-chatty-months-shout.js";import{q as Q,O as $}from"./_applist-chatty-months-shout-814.js";import{M as ce}from"./index-chatty-months-shout-783.js";import{I as ne,T as Ne,B as Z,C as ve,R as Re}from"./index-chatty-months-shout-522.js";import{u as je}from"./usewebho-chatty-months-shout-688.js";import{u as Me,f as $e,a as De,J as x,b as he,A as D,c as We}from"./index-chatty-months-shout-30.js";import{V as I,R as P}from"./import-chatty-months-shout-469.js";import{T as E,R as Le,S as ee}from"./index-chatty-months-shout-83.js";import{S as ue}from"./index-chatty-months-shout-544.js";import{u as Se}from"./utilscss-chatty-months-shout-874.js";import{I as de}from"./index-chatty-months-shout-138.js";import{P as Fe}from"./index-chatty-months-shout-969.js";import{F as _e}from"./index-chatty-months-shout-455.js";import{F as Ee}from"./index-chatty-months-shout-621.js";import{M as Oe}from"./index-chatty-months-shout-749.js";import{S as Pe}from"./index-chatty-months-shout-197.js";import"./index-chatty-months-shout-303.js";import{S as Be}from"./index-chatty-months-shout-53.js";import{A as He}from"./appheade-chatty-months-shout-709.js";import"./lodash-chatty-months-shout-731.js";import"./index-chatty-months-shout-349.js";import"./index-chatty-months-shout-37.js";import"./index-chatty-months-shout-513.js";import"./usedebou-chatty-months-shout-812.js";import"./index-chatty-months-shout-719.js";import"./useclosa-chatty-months-shout-441.js";import"./index-chatty-months-shout-289.js";import"./index-chatty-months-shout-585.js";import"./usebreak-chatty-months-shout-719.js";import"./oauthhel-chatty-months-shout-704.js";import"./index.es-chatty-months-shout-658.js";import"./exporthe-chatty-months-shout-341.js";import"./index-chatty-months-shout-617.js";import"./dropdown-chatty-months-shout-782.js";import"./paginati-chatty-months-shout-250.js";import"./index-chatty-months-shout-629.js";import"./index-chatty-months-shout-813.js";import"./index-chatty-months-shout-115.js";import"./index-chatty-months-shout-348.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ue(){const{isPending:e,mutateAsync:t}=oe({mutationFn:async o=>ie(`webhooks/${o.webhook_id}/update`,{flow_id:o.flow_id},void 0,"POST"),mutationKey:["updateWebhook"]});return{isUpdatingWebhook:e,updateWebhook:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function q(e){if(!Array.isArray(e))return{};const t={};for(const o of e){const{dType:s,label:c,value:i}=o;switch(s){case I.ARRAY:{const u=q(i);t[c]=Object.values(u);break}case I.COLLECTION:{t[c]=q(i);break}default:{t[c]=i;break}}}return t}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function be({wrapperClassName:e}){var y;const t=Number((y=G())==null?void 0:y.flowId),{id:o}=B(Y),[s,c]=re(Q(o)),[i,u]=R.useState(!1),{isListening:r,startHookListen:j,stopHookListen:k}=Me({listenerType:"CAPTURE",onSuccess:({code:f,data:T})=>{f!=="SUCCESS"||Array.isArray(T)||(u(!0),c(g=>J(g,v=>{v.variables=$e(T.variables)})))},params:{flowId:t,nodeId:o}}),{formattedTime:m}=De({durationInSeconds:180,isActive:r,onComplete:k});if(R.useEffect(()=>{u(!1)},[s.machineSlug]),!Number.isNaN(t))return N("div",{className:le([e,"space-y-4"]),children:[a(L,{conditions:!r,children:a(S,{icon:a(fe,{size:16}),onClick:j,type:"primary",children:b("Listen Response")})}),a(L,{conditions:r,children:N(ge,{align:"baseline",children:[a(S,{icon:a(pe,{size:16}),onClick:k,type:"primary",children:b("Stop")}),a(Ce,{size:16}),N(E.Text,{children:[b("Listening"),"..."]}),a(E.Text,{type:"secondary",children:m})]})}),a(L,{conditions:[!s.variables||!s.variables.length],children:a(U,{description:a("span",{dangerouslySetInnerHTML:{__html:b("Click the <b>Listen Response</b> button and submit your trigger. The captured response will be displayed below. The listener will stop automatically after <b>3 minutes</b>.")}}),type:"warning"})}),a(L,{conditions:i,children:a(U,{className:"w-full",message:b("Response captured"),showIcon:!0,type:"success"})}),a(L,{conditions:[s.variables&&s.variables.length],children:a(U,{className:"border-sky-300 bg-sky-100 text-sky-800 dark:border-sky-800 dark:bg-sky-950 dark:text-sky-100",description:b("Use a Condition node immediately after the Trigger node to filter the hook responses—like Form ID, Page ID, or other criteria—so that only the relevant data continues in the workflow."),icon:a(ke,{size:16}),showIcon:!0})}),N(L,{conditions:s.variables&&s.variables.length,children:[a(E.Title,{className:"mb-0.5",level:5,children:b("Captured Response")}),a(x,{className:"max-h-64 text-xs",data:q(s.variables)})]}),s.appSlug==="webhook"&&N(K,{children:[a(E.Title,{className:"mb-0 mt-2",level:5,children:b("Instant Webhook Response")}),N(P.Group,{defaultValue:"a",size:"small",children:[a(P.Button,{value:"a",children:b("Default Response")}),a(V,{title:b("Custom response feature is not available yet. But planned."),children:a(P.Button,{disabled:!0,value:"d",children:b("Custom Response")})}),a(V,{title:b("Custom response feature is not available yet. But planned."),children:a(P.Button,{disabled:!0,value:"d",children:b("Disable")})})]}),a(x,{className:"text-xs",data:{code:"SUCCESS",data:"Accepted",status:"success"}})]})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ve(e){const t=ye(),{isPending:o,mutateAsync:s}=oe({mutationFn:async c=>ie("webhooks/save",c,void 0,"POST"),mutationKey:["saveWebhook"],onSuccess:c=>{c.data&&t.setQueryData(["webhooks",e||"all",c.data.app_slug||"all"],i=>i&&{...i,data:[...i.data||[],c.data]})}});return{isSavingWebhook:o,saveWebhook:s}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const{Title:qe}=E,te=e=>e?`${e} ${b("webhook")}`:b("Untitled webhook");function ze({appName:e,appSlug:t,children:o,onPopoverToggle:s,onSave:c,onValidate:i,onWebhookChange:u}){var W;const r=Number((W=G())==null?void 0:W.flowId),[j,k]=R.useState(!1),{isSavingWebhook:m,saveWebhook:y}=Ve(r),[f,T]=R.useState({app_slug:t,title:te(e)}),g=()=>{k(h=>(s==null||s(!h),!h))},v=()=>{k(!1),s==null||s(!1)},w=h=>p=>{T(l=>J(l,d=>{d[h]=p.target.value}))};return a(Fe,{content:N(_e,{className:"space-y-4",onFinish:async()=>{if(i&&i(f)===!1)return;const{data:h}=await y({...f,flow_id:r});u({id:h.id,url:h.url}),c==null||c(h),v(),T({app_slug:t,title:te(e)})},children:[a(de,{disabled:m,label:b("Webhook name"),onChange:w("title"),required:!0,value:f.title}),o,N(Ee,{gap:8,justify:"end",children:[a(S,{onClick:v,children:b("Cancel")}),a(S,{htmlType:"submit",loading:m,type:"primary",children:"Save"})]})]}),destroyTooltipOnHide:!0,open:j,placement:"right",styles:{body:{maxHeight:"100vh",maxWidth:400,overflowY:"auto"}},title:N(Le,{justify:"space-between",children:[a(qe,{css:Se({mb:"0*"}),level:5,children:b("Create a webhook")}),a(S,{disabled:m,icon:a(we,{}),onClick:v,size:"small",type:"text"})]}),trigger:"click",children:a(V,{title:b("Add new webhook"),children:a(S,{onClick:g,children:b("Add Webhook")})})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ge({appName:e,appSlug:t,children:o,invalidMessage:s,onPopoverToggle:c,onRender:i,onSave:u,onValidate:r,onWebhookChange:j,status:k,value:m,wrapperClassName:y}){var h;const f=Number((h=G())==null?void 0:h.flowId),{isWebhookLoading:T,webhooks:g}=je(f,t),{updateWebhook:v}=Ue();R.useEffect(()=>{i==null||i()},[]);const w=R.useMemo(()=>g.map(p=>({label:p.title,value:p.id})),[g]),n=()=>{var p;return((p=g.find(l=>l.id===m))==null?void 0:p.url)||""},W=async p=>{var d;const l=((d=g.find(C=>C.id===p))==null?void 0:d.url)||"";j({id:p,url:l}),v({flow_id:f,webhook_id:p})};if(!Number.isNaN(f))return N("div",{className:"space-y-4",children:[a(ue,{invalidMessage:s,label:b("Webhook"),loading:T,onChange:W,optionFilterProp:"label",options:w,placeholder:b("Choose a webhook"),showSearch:!0,status:k,suffix:a(ze,{appName:e,appSlug:t,onPopoverToggle:c,onSave:u,onValidate:r,onWebhookChange:j,children:o},`webhook-popover-${f}-${t}`),value:m,wrapperClassName:le([y,"w-100"])}),m&&N(K,{children:[a(ne,{label:b("Callback URL"),value:n()}),a(be,{})]})]},`${f}-${t}`)}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ye={a:({children:e,href:t})=>a("a",{className:"text-blue-500 decoration-wavy hover:underline",href:t,rel:"noreferrer",target:"_blank",children:e}),code:({children:e})=>a("code",{className:"rounded bg-gray-200 p-1 dark:bg-slate-700 dark:text-slate-50",children:e}),h1:({children:e})=>a("h1",{className:"text-sm font-bold text-slate-600 dark:text-slate-200",children:e}),h2:({children:e})=>a("h2",{className:"text-sm font-bold text-slate-600 dark:text-slate-200",children:e}),h3:({children:e})=>a("h3",{className:"text-sm font-bold text-slate-600 dark:text-slate-200",children:e}),hr:()=>a("hr",{className:"my-2 border-b-0 border-t border-slate-300 dark:border-slate-600"}),p:({children:e})=>a("p",{className:"m-0 text-gray-600 dark:text-slate-100",children:e})};function me({className:e,note:t,onRender:o}){R.useEffect(()=>{o==null||o()},[]);const s=Array.isArray(t)?t.join(`
`):t;return a("div",{className:F(["rounded border border-solid px-2 py-1 text-sm","border-slate-200 bg-slate-100 text-gray-500","dark:border-slate-800 dark:bg-slate-900 dark:text-gray-300",e]),children:a(Oe,{components:Ye,children:s})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Je({componentId:e,setComponent:t,setDb:o}){const s=R.useCallback(u=>{t(e,r=>{r.modelDefined=u}),o==null||o(r=>{(!r.modelDefined||Array.isArray(r.modelDefined))&&(r.modelDefined={}),u?r.modelDefined[e]=u:e in r.modelDefined&&Reflect.deleteProperty(r.modelDefined,e)})},[e,t,o]),c=R.useCallback(()=>s(!0),[s]);return{disableModelDefined:R.useCallback(()=>s(!1),[s]),enableModelDefined:c}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ae({componentId:e,setComponent:t,setDb:o,...s}){const{disableModelDefined:c,enableModelDefined:i}=Je({componentId:e,setComponent:t,setDb:o});return a(Ne,{...s,onDisableModelDefined:c,onEnableModelDefined:i})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const se=R.memo(z);function z({appName:e,appSlug:t,component:o,index:s,nodeId:c,parentComponentIndex:i}){const u=R.useRef(!1),{handleComponentsEvents:r,handleComponentsEventsAsync:j,setComponent:k,setDb:m}=he(c),{subNodeType:y}=B(Y),f=y==="tool",T=(l,d,C)=>typeof l=="boolean"?l:r(l,d,C,i)();R.useEffect(()=>{const l=setTimeout(()=>{u.current=!0},100);return()=>{u.current=!1,clearTimeout(l)}},[]);const{componentGroupId:g,componentName:v,fieldType:w,id:n,render:W,...h}=o,p=T(W,s,n);return a(Te,{children:(()=>{if(v===$.select&&p){const{onChange:l,onLoadData:d,onRefetch:C,onRender:A,...M}=h;return a(D,{enableAnimate:u.current,children:a(ue,{...A&&{onRender:r(A,s,n,i)},...l&&{onChange:r(l,s,n,i)},...d&&{onLoadData:j(d,s,n,i)},...C&&{suffix:a(Z,{icon:Ae,loading:o.loading,onClick:r(C,s,n,i),tooltip:o.loading?"Refetching...":"Refetch List"})},...M})})}if(o.componentName===$.input&&p){const{onChange:l,onRender:d,...C}=h;return a(D,{enableAnimate:u.current,children:a(de,{...d&&{onRender:r(d,s,n,i)},...l&&{onChange:r(l,s,n,i)},...C})})}if(o.componentName===$.button&&p){const{onClick:l,onRender:d,...C}=h;return a(D,{enableAnimate:u.current,children:a(Z,{...d&&{onRender:r(d,s,n,i)},...l&&{onClick:r(l,s,n,i)},...C})})}if(o.componentName===$.mixInput&&p){const{modelDefined:l,onChange:d,onRender:C,...A}=h;return a(D,{enableAnimate:u.current,children:a(ae,{componentId:n,isTool:f,label:A.label,modelDefined:l,setComponent:k,setDb:m,children:a(ce,{...C&&{onRender:r(C,s,n,i)},...d&&{onChange:r(d,s,n,i)},...A,className:F(A.className,f&&"flex-1"),wrapperClassName:F(A.wrapperClassName,f&&"w-100")})})})}if(o.componentName===$.note&&p&&t){const{...l}=h;return a(D,{enableAnimate:u.current,children:a(me,{...l})})}if(o.componentName===$.connection&&p&&t){const{extraComponents:l,onConnectionAddChange:d,onConnectionChange:C,onRender:A,onValidate:M,...H}=h;return a(D,{enableAnimate:u.current,children:a(ve,{appName:e||"",appSlug:t,onConnectionChange:r(C,s,n,i),...d&&{onConnectionAddChange:r(d,s,n,i)},...M&&{onValidate:r(M,s,n,i)},...A&&{onRender:r(A,s,n,i)},...H,children:(l==null?void 0:l.length)&&l.map((O,_)=>a(z,{appName:e||"",appSlug:t,component:O,index:_,nodeId:c,parentComponentIndex:s},`extra-component-${_}-${O.id}-${c}`))})})}if(o.componentName===$.repeaterField&&p){const{labelActionOnClick:l,onChange:d,onRender:C,...A}=h;return a(D,{enableAnimate:u.current,children:a(Re,{...C&&{onRender:r(C,s,n,i)},...d&&{onChange:r(d,s,n,i)},...l&&{labelActionOnClick:r(l,s,n,i)},...A,isTool:f})})}if(o.componentName===$.webhook&&p&&t){const{extraComponents:l,onPopoverToggle:d,onRender:C,onSave:A,onValidate:M,onWebhookChange:H,...O}=h;return a(D,{enableAnimate:u.current,children:a(Ge,{appName:e,appSlug:t,onWebhookChange:r(H,s,n,i),...C&&{onRender:r(C,s,n,i)},...d&&{onPopoverToggle:r(d,s,n,i)},...A&&{onSave:r(A,s,n,i)},...M&&{onValidate:r(M,s,n,i)},...O,children:(l==null?void 0:l.length)&&l.map((_,X)=>a(z,{appName:e||"",appSlug:t,component:_,index:X,nodeId:c,parentComponentIndex:s},`extra-component-${X}-${_.id}-${c}`))})})}if(o.componentName===$.hookListener&&p)return a(D,{enableAnimate:u.current,children:a(be,{})});if(o.componentName===$.InputCopyable&&p)return a(D,{enableAnimate:u.current,children:a(ne,{label:o==null?void 0:o.label,value:o==null?void 0:o.value})});if(o.componentName===$.switch&&p){const{modelDefined:l,onChange:d,onClick:C,onRender:A,...M}=h;return a(D,{enableAnimate:u.current,children:a(ae,{componentId:n,isTool:f||!1,label:M.label,modelDefined:l,setComponent:k,setDb:m,wrapperClassName:"flex items-center",children:a(Pe,{...A&&{onRender:r(A,s,n,i)},...d&&{onChange:r(d,s,n,i)},...C&&{onClick:r(C,s,n,i)},...M,wrapperClassName:F(M.wrapperClassName,f&&"flex-1")})})})}})()})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ke({appName:e,appSlug:t,components:o,machineSlug:s,nodeId:c}){var f,T;const{handleMachineEvent:i}=he(c),{subNodeType:u}=B(Y),[r,j]=re(Q(c)),k=g=>{j(v=>J(v,w=>{var n;w!=null&&w.states||(w.states={components:[]}),(n=w==null?void 0:w.states)!=null&&n.tool||(w.states.tool={description:[]}),w.states.tool.description=g}))};R.useEffect(()=>{!Array.isArray(o)||o.length===0||i("ON_MACHINE_LOAD")},[s,o==null?void 0:o.length]);const m=new Map,y=new Map;return N("div",{className:"space-y-4",children:[u==="tool"&&a(ce,{className:"h-16",helperText:b("Help your agent understand when to use the tool. Describe what it does and in what situations it should be used."),label:b("Description"),onChange:k,required:!0,value:((T=(f=r==null?void 0:r.states)==null?void 0:f.tool)==null?void 0:T.description)||[]}),o==null?void 0:o.map((g,v)=>{if("componentGroupId"in g&&!y.has(g.id)){const w=g.componentGroupId,n=[],W=o.filter((h,p)=>{if(h.componentGroupId===w)return n.push(p),!0});return a("div",{className:"w-100 flex gap-2",children:W.map(h=>{if(!y.has(h.id)){if(m.has(h.id)){console.error(`Component id ${h.id} is duplicated`,m,y);return}return m.set(h.id,1),y.set(h.id,1),a("div",{className:h.groupItemClassName,style:h.groupItemStyle,children:a(se,{appName:e,appSlug:t,component:h,index:n.shift()||0,nodeId:c})},`${h.id}-${t}-${s}-${c}`)}})},`${w}${t}${s}`)}if(!y.has(g.id)){if(m.has(g.id)){console.error(`Component id ${g.id} is duplicated`,m,y);return}return m.set(g.id,1),y.set(g.id,1),a(se,{appName:e,appSlug:t,component:g,index:v,nodeId:c},`${g.id}-${t}-${s}-${c}`)}})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ft({nodeId:e}){var T,g;const t=B(Q(e)),{appColor:o,appIcon:s,appSlug:c,appTitle:i,machineLabel:u,machineSlug:r,runType:j,states:k,topBanner:m}=t,{isNodeDetailsFetching:y,isNodeDetailsLoading:f}=We(e,c||"",r||"",((T=k==null?void 0:k.components)==null?void 0:T.length)||0);return N(K,{children:[a(He,{appColor:o,appIcon:s,appTitle:i,isLoading:y,machineLabel:u}),a(L,{conditions:[!f,m,m==null?void 0:m.length],children:a(me,{className:"mb-2",note:m||""},`note-${c}-${u}-${i}`)}),a(L,{conditions:f&&!y||!((g=k==null?void 0:k.components)!=null&&g.length)&&y,children:Array.from({length:2}).map((v,w)=>N("div",{className:"mb-4",children:[a(ee,{active:!0,className:"w-56",paragraph:!1}),a(ee.Input,{active:!0,block:!0})]},`sk-${w}`))}),a("div",{className:F([y&&"cursor-wait opacity-80"]),children:N("div",{className:F([y&&"pointer-events-none"]),children:[j==="trigger"&&t.triggerType==="polling"&&a(Be,{buttonText:b("Add Poll Time"),title:b("Poll Times")}),!f&&(k==null?void 0:k.components)&&a(Ke,{appName:i,appSlug:c,components:k.components,machineSlug:r,nodeId:e})]})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{Ft as default};

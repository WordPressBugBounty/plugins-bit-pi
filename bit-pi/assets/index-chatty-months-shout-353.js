const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./template-chatty-months-shout-788.js","./_applist-chatty-months-shout-814.js","./lodash-chatty-months-shout-731.js","./main-chatty-months-shout.js","./main-bit-pi-ba-assets-chatty-months-shout.css","./template-chatty-months-shout-355.js"])))=>i.map(i=>d[i]);
import{r as n,I as Le,c as Be,d as ze,u as he,q as I,e as ce,f as de,g as Ue,h as q,i as Re,k as He,j as a,A as G,a as d,l as oe,_ as s,B as $,L as ue,t as be,m as N,n as Te,o as we,S as W,p as Ce,N as ve,F as ye,s as Ke,v as qe,w as Ae,x as Ve,y as te,z as We,R as Fe,C as ge,D as Ge,E as Qe,G as Xe}from"./main-chatty-months-shout.js";import{m as Je,D as xe,a as Ye,b as Ze,F as et,u as tt}from"./dropdown-chatty-months-shout-782.js";import{$ as je,d as re,a as at,A as ot}from"./_applist-chatty-months-shout-814.js";import{c as st}from"./exporthe-chatty-months-shout-341.js";import{I as se}from"./index-chatty-months-shout-138.js";import{T as D,R as Me,C as me}from"./index-chatty-months-shout-83.js";import{M as V,E as pe}from"./index-chatty-months-shout-585.js";import{F as ne}from"./index-chatty-months-shout-455.js";import{T as it}from"./index-chatty-months-shout-719.js";import{S as lt}from"./index-chatty-months-shout-544.js";import{S as ct}from"./index-chatty-months-shout-115.js";import{I as rt}from"./index-chatty-months-shout-289.js";import{P as nt}from"./paginati-chatty-months-shout-250.js";import"./index-chatty-months-shout-513.js";import"./index.es-chatty-months-shout-658.js";import"./lodash-chatty-months-shout-731.js";import"./useclosa-chatty-months-shout-441.js";import"./usebreak-chatty-months-shout-719.js";var ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},dt=function(t,o){return n.createElement(Le,Be({},t,{ref:o,icon:ht}))},ke=n.forwardRef(dt);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ut(){const[e,t]=ze(je),{data:o,isLoading:i}=he({queryFn:({signal:c})=>I("custom-apps-active",void 0,void 0,"GET",{signal:c}),queryKey:["appList"],select:c=>Je(c.data)});return n.useEffect(()=>{Array.isArray(o)&&t(c=>[...c.filter(h=>!h.isCustom),...o])},[o,t]),{appList:e,isAppLoading:i}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const fe=Object.assign({"../templates/template-1.ts":()=>ce(()=>import("./template-chatty-months-shout-788.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),"../templates/template-2.ts":()=>ce(()=>import("./template-chatty-months-shout-355.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url),"../templates/templates.ts":()=>ce(()=>Promise.resolve().then(()=>Ot),void 0,import.meta.url)}),Q=st((e,t)=>({errorMessage:"",flowData:re,flowTitle:"Untitled Flow",handleFlowTitleChange:o=>{e(i=>({...i,flowTitle:o,isTitleChangedByUser:!0}))},handleModal:o=>{e(i=>({...i,flowData:re,flowTitle:"Untitled Flow",isCreateFlowModalOpen:o,isTitleChangedByUser:!1,selectedTemplateId:o&&"blank"}))},isCreateFlowModalOpen:!1,isFetchingTemplate:!1,isTitleChangedByUser:!1,selectedTemplateId:"blank",selectTemplate:async(o,i)=>{var c;if(o==="blank"){if(e(h=>({...h,flowData:re,selectedTemplateId:o})),t().isTitleChangedByUser)return;e({flowTitle:"Untitled Flow"});return}e({isFetchingTemplate:!0});for(const h in fe)if((c=h.split("/").at(-1))!=null&&c.includes(`${o}.ts`)){const m=await fe[h]();e(T=>({...T,flowData:m.default,selectedTemplateId:o})),t().isTitleChangedByUser||e({flowTitle:i});break}e({isFetchingTemplate:!1})},setCreateFlowModalOpen:o=>e({isCreateFlowModalOpen:o}),setErrorMessage:o=>e({errorMessage:o}),setFlowData:o=>e({flowData:o}),setSelectedTemplateId:o=>e({selectedTemplateId:o})}));globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function gt(){const e=de(at),t=Ue(),{setCreateFlowModalOpen:o}=Q(),{isPending:i,mutateAsync:c}=q({mutationFn:async h=>I("flows/save",h),mutationKey:["save_flow"],onSuccess:h=>{h.data.id&&(e(h.data),o(!1),t(`/flows/details/${h.data.id}`))}});return{isFlowSaving:i,saveFlow:c}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ie=globalThis.jotaiAtomCache.get("/home/runner/work/bit-pi/bit-pi/frontend/src/common/globalStates/$flows.ts/$flows",Re([]));ie.debugLabel="$flows";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function mt(e){const t=de(ie),o=e.searchKeyValue.tags.join(""),{data:i,isFetching:c,isLoading:h}=he({placeholderData:He,queryFn:()=>I("flows/search",e),queryKey:["search_flows",e.page,e.limit,o,e.searchKeyValue.title],select:m=>m.data});return n.useEffect(()=>{t((i==null?void 0:i.flows)||[])},[i==null?void 0:i.flows,t]),{fetchedFlows:(i==null?void 0:i.flows)||[],isFlowsFetching:c,isFlowsLoading:h,totalFetchedFlow:(i==null?void 0:i.totalFlows)||0}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function pt(){const{mutateAsync:e}=q({mutationFn:async t=>I("tags/delete",{tagId:t}),mutationKey:["delete_tags"]});return{deleteTag:e}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ft(){const{isPending:e,mutateAsync:t}=q({mutationFn:async o=>I("tags/save",{title:o}),mutationKey:["save_tags"]});return{isSavingTag:e,saveTag:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function _e(){const{data:e,isLoading:t,refetch:o}=he({queryFn:async()=>I("tags",void 0,void 0,"GET"),queryKey:["all_tags"]});return{isTagsLoading:t,refetchTag:o,tags:(e==null?void 0:e.data)||[]}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function bt(){const{isPending:e,mutateAsync:t}=q({mutationFn:async o=>I("tags/update",o),mutationKey:["update_tags"]});return{isUpdatingTag:e,updateTag:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Tt(){const{isPending:e,mutateAsync:t}=q({mutationFn:async o=>I("tags/updateStatus",o),mutationKey:["update_tag_status"]});return{isUpdatingTagStatus:e,updateTagStatus:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function wt({className:e,size:t="1em",stroke:o=.2}){return a(G,{children:a("svg",{className:e,fill:"currentColor",height:t,stroke:"currentColor",strokeWidth:o,viewBox:"0 0 16 16",width:t,children:a("path",{d:`M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588c-.177 0-.335-.018-.46-.039l-3.134 3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032
           1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828l-3.182 3.182c-.195.195-1.219.902-1.414.707c-.195-.195.512-1.22.707-1.414l3.182-3.182l-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688
           1.673-.767 2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146zm.122 2.112v-.002v.002zm0-.002v.002a.5.5 0
           0 1-.122.51L6.293 6.878a.5.5 0 0 1-.511.12H5.78l-.014-.004a4.507 4.507 0 0 0-.288-.076a4.922 4.922 0 0 0-.765-.116c-.422-.028-.836.008-1.175.15l5.51 5.509c.141-.34.177-.753.149-1.175a4.924
           4.924 0 0 0-.192-1.054l-.004-.013v-.001a.5.5 0 0 1 .12-.512l3.536-3.535a.5.5 0 0 1 .532-.115l.096.022c.087.017.208.034.344.034c.114 0 .23-.011.343-.04L9.927 2.028c-.029.113-.04.23-.04.343a1.779 1.779 0 0 0 .062.46z`})})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ct({className:e,size:t="1em"}){return a(G,{children:a("svg",{className:e,fill:"currentColor",height:t,viewBox:"0 0 16 16",width:t,children:a("path",{d:`M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588c-.177 0-.335-.018-.46-.039l-3.134
          3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828l-3.182
          3.182c-.195.195-1.219.902-1.414.707c-.195-.195.512-1.22.707-1.414l3.182-3.182l-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767
          2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146z`})})})}const vt="_tagList_t1o7c_5",yt="_tagItem_t1o7c_15 flx ai-cen jc-sb pos-rel",At="_tagItemActionBtn_t1o7c_20",Ft="_pinTag_t1o7c_28",xt="_tagItemAction_t1o7c_20 pos-abs",jt="_tagItemTitle_t1o7c_37",K={tagList:vt,tagItem:yt,tagItemActionBtn:At,pinTag:Ft,tagItemAction:xt,tagItemTitle:jt};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Mt=({handleOnAdd:e,isAddable:t,token:o})=>function(c){return d("div",{css:oe({backgroundColor:o.colorBgElevated,borderRadius:o.borderRadiusLG,boxShadow:o.boxShadowSecondary},"",""),children:[a(D.Title,{"aria-label":s("tags list"),className:"m-1 px-2 py-1 text-sm",css:oe({borderBottom:`1px solid ${o.colorSplit}`},"",""),level:5,children:s("Tags")}),n.cloneElement(c,{style:{boxShadow:"none"}}),t&&a("div",{className:"p-2",children:a($,{"aria-label":s("add tag"),block:!0,icon:a(ue,{}),onClick:e,size:"small",children:s("Add Tag")})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};var kt={name:"158icaa",styles:"margin-left:4px"};function _t({className:e,onActive:t,onAdd:o,onEdit:i,onInactive:c,onPin:h,onRemove:m,onUnpin:T,tagsList:g}){const{token:v}=be.useToken(),[y,F]=n.useState(!1),M=n.useMemo(()=>g==null?void 0:g.every(l=>!l.active),[g]),P=()=>M?[]:g==null?void 0:g.filter(l=>l.active).map(l=>l.id.toString()),f=()=>{o==null||o(),F(!1)},x=l=>j=>{j.stopPropagation(),i==null||i(l),F(!1)},w=l=>j=>{j.stopPropagation(),m==null||m(l),F(!1)},p=(l,j)=>A=>{A.stopPropagation(),j?T==null||T(l):h==null||h(l)},S=g==null?void 0:g.map(l=>({key:l.id,label:d("div",{className:N([K.tagItem,"group"]),css:oe({borderRadius:v.borderRadius,paddingBlock:2},"",""),children:[d("span",{className:K.tagItemTitle,children:[h&&a($,{"aria-label":s("pin or unpin tag"),className:N([l.pinned&&K.pinTag,l.active&&"group-hover:text-white"]),icon:Number(l.pinned)?a(Ct,{size:12}):a(wt,{size:12}),onClick:p(l.id,l.pinned),size:"small",type:"text"}),a("span",{"aria-label":`tag-${l.id}`,className:N([l.active&&"group-hover:text-white"]),css:kt,children:l.label})]}),d("div",{className:`${K.tagItemAction}`,children:[i&&a($,{"aria-label":s("edit tag"),className:N([K.tagItemActionBtn,l.active&&"group-hover:text-white"]),icon:a(Te,{size:13}),onClick:x(l.id),size:"small",type:"text"}),m&&a($,{"aria-label":s("delete tag"),className:N([K.tagItemActionBtn,l.active&&"group-hover:text-white"]),icon:a(we,{size:13}),onClick:w(l.id),size:"small",type:"text"})]})]})}));return d(W,{className:e,size:4,children:[a($,{"aria-label":s("All tags"),onClick:()=>M?c(0):t(0),shape:"round",type:`${M?"primary":"default"}`,children:s("All")}),g==null?void 0:g.map(l=>l.pinned&&a($,{"aria-label":s("pinned tag"),onClick:()=>l.active?c(l.id):t(l.id),shape:"round",type:`${l.active?"primary":"default"}`,children:l.label},l.id)),a(xe,{arrow:!0,dropdownRender:Mt({handleOnAdd:f,isAddable:!!o,token:v}),menu:{className:`${K.tagList} scroller thin`,items:S,multiple:!0,onDeselect:l=>c(Number(l.key)),onSelect:l=>t(Number(l.key)),selectable:!0,selectedKeys:P()},onOpenChange:F,open:y,placement:"bottom",trigger:["click"],children:a($,{"aria-label":s("more tags"),icon:a(Ce,{}),shape:"circle"})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function St({activeTag:e,setActiveTag:t}){var Z,ee;const{refetchTag:o,tags:i}=_e(),{isSavingTag:c,saveTag:h}=ft(),{isUpdatingTag:m,updateTag:T}=bt(),{updateTagStatus:g}=Tt(),{deleteTag:v}=pt(),{messageApi:y}=n.useContext(ve),[F,M]=n.useState(!1),[P,f]=n.useState(!1),[x,w]=n.useState(""),[p,S]=n.useState(),[l,j]=V.useModal(),A=n.useRef(),L=u=>{t(C=>u===0?[]:C.includes(u)?C.filter(_=>_!==u):[...C,u])},R=async()=>{const{data:u,status:C}=await h(x).catch(_=>_);if(C==="error"){S(u);return}w(""),M(!1),o(),S(void 0),y==null||y.success("Tag created successfully")},b=async()=>{A.current&&(await v(A.current),o(),y==null||y.success("Tag deleted successfully"))},B=u=>{A.current=u,l.confirm({content:"If you delete you can't recover it",icon:a(ke,{}),okText:s("Delete"),onOk:b,title:s("Are you Confirm to Delete?")})},z=u=>{const C=i.find(_=>_.id===u);C&&(A.current=u,w(C.title),f(!0))},X=async u=>{const C=i.find(_=>_.id===u);C&&(await g({id:u,status:!Number(C.status)}),o())},E=()=>{w(""),M(!0)},J=u=>async()=>{const{data:C,status:_}=await T({id:u,title:x}).catch(le=>le);if(_==="error"){S(C);return}w(""),f(!1),o(),S(void 0)},Y=i.map(u=>({active:e.includes(u.id),id:u.id,label:u.title,pinned:!!Number(u.status)}));return d(ye,{children:[j,a(_t,{className:"mb-4 mt-2",onActive:L,onAdd:E,onEdit:z,onInactive:L,onPin:X,onRemove:B,onUnpin:X,tagsList:Y}),a(V,{closeIcon:a(Ke,{}),confirmLoading:c,okButtonProps:{disabled:!x.length},okText:s("Save"),onCancel:()=>M(!1),onOk:R,open:F,title:s("Create Tag"),children:a("div",{className:"mt-4",children:a(ne,{disabled:c,onFinish:R,children:a(se,{invalidMessage:(Z=p==null?void 0:p.title)==null?void 0:Z[0],name:"tagName",onChange:u=>w(u.target.value),placeholder:s("Write tag name"),status:(p==null?void 0:p.title)&&"error",title:s("Tag name"),value:x})})})},`tag-confirmation-modal-${n.useId}`),a(V,{confirmLoading:m,okButtonProps:{disabled:!x.length},okText:s("Update"),onCancel:()=>f(!1),onOk:J(A.current||0),open:P,title:s("Edit Tag"),children:a(ne,{disabled:m,onFinish:J(A.current||0),children:a(se,{invalidMessage:(ee=p==null?void 0:p.title)==null?void 0:ee[0],name:"title",onChange:u=>w(u.target.value),placeholder:s("Edit tag name"),status:(p==null?void 0:p.title)&&"error",title:s("Tag name"),value:x})})},`tag-edit-modal-${n.useId}`)]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Nt="https://bit-flows.com/users-guide/",It={getStarted:`${Nt}get-started-with-bit-flows/`};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Et({className:e,link:t,text:o,wrapperClassName:i}){return d("span",{className:N("inline-flex gap-1 text-orange-500 decoration-wavy underline-offset-2 hover:text-orange-600 hover:underline",i),children:[a("a",{className:N(["text-orange-500 hover:text-orange-600",e]),href:`${t}?utm_source=flow_plugin`,rel:"noreferrer noopener nofollow",target:"_blank",children:o}),a(qe,{})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Se=[{description:s("Create from scratch."),id:"blank",logos:[],name:s("Blank"),nodeCount:0},{description:s("Manage bulk data and send it to MailChimp and Google Sheets  (handled and filtered by tools)."),id:"template-1",logos:["webhook","googleSheet","mailChimp"],name:s("Example Flow"),nodeCount:2,proRequired:!0},{description:s("Send data to MailerLite and Brevo using the router after forms new record."),id:"template-2",logos:["elementorForm","mailerLite","brevo"],name:s("Elementor Form to Email Marketing"),nodeCount:3}],Ot=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"})),$t="_itemHeader_162bj_14 flx ai-cen jc-sb",Dt="_itemHeaderIcon_162bj_19",Pt="_imgWrap_162bj_23",Lt="_nodesCount_162bj_50",ae={itemHeader:$t,itemHeaderIcon:Dt,imgWrap:Pt,nodesCount:Lt};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Bt({nodes:e,nodesCount:t}){const o=Ae(je),{token:i}=be.useToken(),c=t-3,h=n.useMemo(()=>e.map(m=>{const{color:T,logoUrl:g}=o.find(v=>v.appSlug===m)||{};return{appSlug:m,color:T,logoUrl:g}}),[o,e]);return a("div",{className:ae.itemHeaderIcon,children:h==null?void 0:h.map(({appSlug:m,color:T,logoUrl:g},v)=>d("span",{className:ae.imgWrap,css:oe({backgroundColor:T||ot,border:`1px solid ${Ve(T,-100)}`,outline:`3px solid ${i.colorBgContainer}`},"",""),children:[g&&a("img",{alt:m,className:"p-1.5",src:g}),v===2&&c>0&&a("span",{className:ae.nodesCount,children:`${c}+`})]},`${m}-${v*2}`))})}const Ne=n.memo(Bt);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function zt({template:e}){const{isFetchingTemplate:t,selectedTemplateId:o,selectTemplate:i}=Q();return d("button",{className:N(["group relative flex w-full cursor-pointer flex-row items-center gap-4 rounded-md border border-solid border-slate-300 bg-transparent px-4 py-3","hover:border-slate-400 hover:bg-slate-100","dark:border-slate-700 dark:hover:border-slate-600 dark:hover:bg-white/5",o===e.id&&"border-orange-500 ring-2 ring-orange-500"]),disabled:t,onClick:()=>i(e.id,e.name),type:"button",children:[d("div",{className:"flex w-full items-center gap-3",children:[d("div",{className:"flex w-24 items-center justify-start",children:[a(te,{conditions:[e.logos.length>0,e.id!=="blank"],children:a(Ne,{nodes:e.logos,nodesCount:e.nodeCount})}),a(te,{conditions:e.id==="blank",children:a("div",{className:"my-1 flex h-12 w-full items-center justify-center rounded-md bg-slate-100 group-hover:bg-slate-200 dark:bg-slate-800 group-hover:dark:bg-slate-700",children:a(ue,{className:"opacity-70",size:24})})})]}),d("div",{className:"flex-1",children:[a(D.Paragraph,{className:N(["mb-0 block rounded-sm text-start text-sm font-medium","group-hover:text-orange-400",o===e.id&&"text-orange-600 dark:text-orange-500"]),children:e.name}),a(D.Paragraph,{className:"mb-0 text-start text-xs text-slate-500",children:e.description})]})]}),a(te,{conditions:[e.proRequired,!We.IS_PRO],children:a(it,{className:"absolute right-0 top-0 m-0 rounded-br-none rounded-tl-none rounded-tr-md text-xs",color:"orange",rootClassName:"border-t-0 border-r-0",children:a(D.Text,{className:"text-xs",children:s("Requires Pro")})})})]},e.id)}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ut(){const{isFetchingTemplate:e}=Q();return d("div",{className:"mb-10 mt-10 space-y-4",children:[d("div",{className:"flex justify-between",children:[d("div",{children:[a(D.Text,{className:"text-sm font-medium",children:s("Choose template:")}),e&&a(Fe,{})]}),a(Et,{link:It.getStarted,text:"Get started (Guide)"})]}),Se.map(t=>a(zt,{template:t},t.id))]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Rt({className:e,size:t="1em",stroke:o=2}){return a(G,{children:d("svg",{className:e,fill:"none",height:t,stroke:"currentColor",strokeMiterlimit:"10",strokeWidth:o,viewBox:"0 0 25 33.1",width:t,children:[a("path",{d:"M20.5 7.7v13.8a4 4 0 0 1-4 4 4 4 0 0 1-4-4v-9.8a4 4 0 0 0-8 0v13.8"}),a("circle",{cx:"20.5",cy:"4.5",r:"3.5"}),a("circle",{cx:"4.5",cy:"28.6",r:"3.5"})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ht(){const{data:e,isPending:t,mutateAsync:o}=q({mutationFn:async i=>I("flows/delete",i),mutationKey:["delete_flow"]});return{deleteFlowData:e,deleteFlowMutate:o,isDeleteFlowLoading:t}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Kt(){const{data:e,error:t,isError:o,isPending:i,mutateAsync:c}=q({mutationFn:async h=>I("flows/update",h),mutationKey:["update_flow"]});return{flowUpdateError:t,isFlowUpdateError:o,isFlowUpdating:i,updateFlow:c,updateFlowData:e==null?void 0:e.data}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function qt({count:e,flowTags:t,id:o,isFlowActive:i,nodes:c,nodesCount:h,title:m}){const[T,g]=n.useState(i),{deleteFlowMutate:v}=Ht(),{flowUpdateError:y,isFlowUpdateError:F,isFlowUpdating:M,updateFlow:P,updateFlowData:f}=Kt(),[x,w]=n.useState(m),p=de(ie),[S,l]=n.useState({isActive:!1,layoutId:""}),{refetchTag:j,tags:A}=_e(),[L,R]=n.useState(""),{messageApi:b}=n.useContext(ve),[B,z]=n.useState(!1),X=t==null?void 0:t.map(r=>r.title),[E,J]=n.useState(X),Y=()=>{l({isActive:!1,layoutId:""}),R("")},Z=r=>()=>{v({id:r}),p(k=>ge(k,U=>U.filter(H=>Number(H.id)!==r))),b==null||b.success(s("Flow deleted successfully"))},ee=(r,k,U)=>{k.preventDefault(),k.stopPropagation(),g(r),P({flow:{is_active:Number(r)},id:U}),b==null||b.success(s("Status updated successfully"))},u=r=>async()=>{const k=E==null?void 0:E.filter(O=>!A.some(Pe=>Pe.title===O)),H=A.filter(O=>E==null?void 0:E.includes(O.title)).map(O=>O.id);try{await P({flow:{title:x},id:r,tag:{newTags:k,oldTagsId:H}}),Y(),b==null||b.success(s("Flow updated successfully"))}catch(O){console.error(O)}},[C,_]=V.useModal(),le=(r,k)=>{r.stopPropagation(),C.confirm({content:s("If you delete you can't recover it"),icon:a(ke,{}),okText:s("Delete"),onOk:Z(Number(k)),title:s("Are you Confirm to Delete?")})},Ie=r=>{r.stopPropagation(),z(!0)},Ee=A.map(r=>({label:r.title,value:r.title})),Oe=r=>{r.stopPropagation(),l({isActive:!0,layoutId:`flowDetails-${o}`})},$e=[{key:"edit",label:d(W,{size:6,children:[a(G,{children:a(Te,{})}),s("Edit")]}),onClick:({domEvent:r})=>Oe(r)},{key:"settings",label:a(Ye,{}),onClick:({domEvent:r})=>Ie(r)},{key:"export",label:a(Ze,{flowId:o}),onClick:({domEvent:r})=>r.stopPropagation()},{danger:!0,key:"delete",label:d(W,{size:6,children:[a(G,{children:a(we,{})}),s("Delete")]}),onClick:({domEvent:r})=>le(r,o)}],De=r=>{J(r)};return n.useEffect(()=>{F&&y&&R(Object.values(y.data).flat().join(", "))},[y,F]),n.useEffect(()=>{w(m)},[m]),n.useEffect(()=>{g(i)},[i]),n.useEffect(()=>{var r;f&&"flowDetails"in f&&p(k=>ge(k,U=>{const H=U.findIndex(O=>O.id===f.flowDetails.id);H!==-1&&(U[H].flowTags=f.flowDetails.flowTags,U[H].title=f.flowDetails.title)})),f&&((r=f==null?void 0:f.insertedNewTags)!=null&&r.length)&&j()},[j,p,f]),d(ye,{children:[_,a(Ge,{to:`../flows/details/${o}`,children:d("div",{className:N(["group h-[118px] rounded-md border border-solid p-3 shadow-sm outline-2 outline-offset-2 transition-all focus-within:outline","border-slate-300 bg-white outline-slate-900","hover:border-slate-400 hover:bg-slate-100","dark:border-slate-700 dark:bg-transparent dark:outline-slate-300 dark:hover:border-slate-600 dark:hover:bg-slate-900"]),"data-testid":"flowItem",children:[d("div",{className:ae.itemHeader,children:[a(Ne,{nodes:c,nodesCount:h}),d(W,{children:[a(xe,{arrow:!0,menu:{items:$e},placement:"bottom",trigger:["click"],children:a($,{"data-testid":"flowItemMenu",icon:a(Ce,{}),onClick:r=>r.preventDefault(),shape:"circle",type:"text"})}),a(ct,{checked:T,onChange:(r,k)=>ee(r,k,Number(o)),size:"small"})]})]}),a(D.Text,{className:"my-2 block rounded-sm text-base font-medium group-hover:text-orange-500",ellipsis:!0,children:m}),d(D.Text,{children:[a(Rt,{size:13})," ",e]})]})}),d(V,{confirmLoading:M,destroyOnClose:!0,okText:s("Update"),onCancel:Y,onOk:u(Number(o)),open:S.isActive,title:s("Edit Flow"),children:[a(se,{label:s("Title"),name:`editFlowTitle-${o}`,onChange:r=>w(r.target.value),placeholder:s("Edit flow title"),type:"text",value:x}),a(lt,{invalidMessage:L,label:s("Tags"),mode:"tags",onChange:De,options:Ee,placeholder:s("Tags"),status:L&&"error",value:E,wrapperClassName:"mt-2"})]}),a(et,{flowId:o,isOpen:B,setIsOpen:z})]})}const Vt=n.memo(qt);globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Wt({totalFetchedFlow:e}){const t=Ae(ie),{handleModal:o}=Q(),i=n.useCallback(c=>c.length>3?c.slice(0,3):c,[]);return d(Me,{gutter:[16,16],children:[a(me,{lg:6,md:8,sm:12,xs:24,children:a($,{"aria-label":s("Create Flow"),className:"h-[116px] w-full rounded-md border-2 border-dashed border-slate-400 hover:border-slate-600 hover:bg-slate-200 dark:border-slate-700 dark:hover:bg-slate-900",onClick:()=>o(!0),variant:"dashed",children:d(D.Text,{className:"flex items-center gap-2 font-medium",children:[a(ue,{size:36}),s("Create Flow")]})})}),!!e&&t&&(t==null?void 0:t.map(c=>a(me,{lg:6,md:8,sm:12,xs:24,children:a(Vt,{count:c.run_count,flowTags:c.flowTags,id:c.id,isFlowActive:!!c.is_active,nodes:i(c.nodes),nodesCount:c.nodesCount,title:c.title})},c.id)))]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};var Gt={name:"1i2yey0",styles:"width:200px !important"};function ga(){const[e,t]=Qe(),o=Number(e.get("page"))||1,i=Number(e.get("limit"))||15,[c,h]=n.useState(""),m=tt(c,400),[T,g]=n.useState([]),{isFlowsFetching:v,isFlowsLoading:y,totalFetchedFlow:F}=mt({limit:i,page:o,searchKeyValue:{tags:T,title:m}}),{isFlowSaving:M,saveFlow:P}=gt(),{errorMessage:f,flowData:x,flowTitle:w,handleFlowTitleChange:p,handleModal:S,isCreateFlowModalOpen:l,setErrorMessage:j}=Q();ut();const A=({target:{value:b}})=>{h(b)},L=async()=>{j(""),w||j(s("Title is required")),await P({...x,title:w})},R=(b,B)=>{t(z=>(z.set("page",b.toString()),z.set("limit",B.toString()),z))};return d("div",{className:"p-6",children:[d(Me,{align:"middle",justify:"space-between",children:[d(W,{className:"mb-3",children:[a(D.Title,{className:"mb-0",level:3,children:s("Flows")}),v&&a(Fe,{})]}),a(rt,{allowClear:!0,css:Gt,onChange:A,placeholder:s("Search"),prefix:a(Xe,{}),type:"search"})]}),a(St,{activeTag:T,setActiveTag:g}),a(Wt,{totalFetchedFlow:F}),!y&&!v&&!F&&a(pe,{description:s("No Flow Found"),image:pe.PRESENTED_IMAGE_SIMPLE}),a(nt,{className:"mt-5 justify-end",current:o,onChange:R,pageSize:i,showSizeChanger:!0,showTotal:(b,B)=>`${B[0]}-${B[1]} of ${b} items`,total:F}),a(V,{centered:!0,confirmLoading:M,okButtonProps:{"aria-label":"Flow title save button"},okText:s("Create"),onCancel:()=>S(!1),onOk:L,open:l,title:s("Create Flow"),children:d(te,{conditions:l,children:[a(ne,{disabled:M,onFinish:L,children:a(se,{"aria-label":s("Flow title input"),invalidMessage:f,label:s("Title"),name:"createFlowTitle",onChange:b=>p(b.target.value),placeholder:s("Write title here..."),status:f?"error":"",type:"text",value:w})}),a(Ut,{})]})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{ga as default};

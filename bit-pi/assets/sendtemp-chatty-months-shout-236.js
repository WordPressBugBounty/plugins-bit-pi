import{aa as _,ab as d}from"./_applist-chatty-months-shout-814.js";import{db as C,_ as o}from"./main-chatty-months-shout.js";import{s as A}from"./machine.-chatty-months-shout-207.js";import{h as s,a as g,b as I,c as f,d as L,r as b}from"./whatsapp-chatty-months-shout-940.js";import"./lodash-chatty-months-shout-731.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const O=(t,e,a)=>C({headers:{Authorization:["Bearer ",{encryption:"hmac_decrypt",value:t}]},method:"GET",url:`https://graph.facebook.com/v19.0/${e}/message_templates?limit=10&after=${a}`});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};let u="";const r=async(t,e=0)=>{var h,E;t.setComponent("template-name",n=>{n.loading=!0});const a=await t.getConnection();if(!a)return;const c=(E=(h=a.auth_details)==null?void 0:h.extraData)==null?void 0:E.businessId;e===0&&(u="");const{data:i,status:l}=await O(a.auth_details.token,c,u);if(l!=="success"){t.setComponent("template-name",n=>{t.util.isSelectComponent(n)&&(n.loading=!1,n.status=l,n.invalidMessage=i)}),console.error("Failed to fetch list");return}u=i.paging.cursors.after,i.data.length===0&&t.setComponent("template-name",n=>{t.util.isSelectComponent(n)&&(n.isLoadable=!1)});const p=i.data.map(n=>{var T;const m=(T=n.components.find(N=>N.format))==null?void 0:T.format;return{label:`${n.name} (${n.language})`,value:`${n.name} ${n.language} ${m}`}});t.setComponent("template-name",n=>{var m;t.util.isSelectComponent(n)&&(n.options=e===0?p:(m=n.options)==null?void 0:m.concat(p),n.loading=!1)})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const P=_(({helpers:t})=>({states:{components:[L(t),b(t),{componentName:t.componentName.select,helperText:o("Select the name of the message template you want to send as message."),id:"template-name",label:o("Select Template Name"),onChange:"SET_TEMPLATE_NAME",onLoadData:"ON_LOAD_CHANNEL_DATA",onRefetch:"REFETCH_TEMPLATE",options:[],path:"template.name",render:"IF_CONNECTION_SELECTED",required:!0,showSearch:!0,value:void 0},{componentName:t.componentName.mixInput,helperText:o("Enter the direct link to the media (image, video or document) you want to send. Must be publicly accessible. Ex: https://example.com/file.jpg"),id:"media-url",label:o("Media URL"),onChange:"SET_MEDIA_URL",path:"link",render:"IF_MEDIA_TEMPLATE",required:!0,value:[]},{componentName:t.componentName.mixInput,helperText:o("Enter the latitude of the location in decimal format. Ex: 23.810331"),id:"latitude",label:o("Latitude"),onChange:"SET_LATITUDE",path:"location.latitude",render:"IF_LOCATION_TEMPLATE",required:!0,value:[]},{componentName:t.componentName.mixInput,helperText:o("Enter the longitude of the location in decimal format. Ex: 90.412521"),id:"longitude",label:o("Longitude"),onChange:"SET_LONGITUDE",path:"location.longitude",render:"IF_LOCATION_TEMPLATE",required:!0,value:[]},{componentName:t.componentName.mixInput,helperText:o("Enter the name of the location. Ex: Dhaka City"),id:"location-name",label:o("Name"),onChange:"SET_LOCATION_NAME",path:"location.name",render:"IF_LOCATION_TEMPLATE",required:!0,value:[]},{componentName:t.componentName.mixInput,helperText:o("Enter the full address of the location. Ex: Dhaka, Bangladesh"),id:"address",label:o("Address"),onChange:"SET_ADDRESS",path:"location.address",render:"IF_LOCATION_TEMPLATE",required:!0,value:[]}]},actions:{CONNECTION_ADD_CHANGE:f,HANDLE_BUSINESS_ID:I,IF_CONNECTION_SELECTED:({$:e})=>{var a;return d((a=e.getComponent("connection-id"))==null?void 0:a.value)},ON_LOAD_CHANNEL_DATA:async({$:e,e:a})=>await r(e,a.count),SET_ADDRESS:s("address"),SET_LATITUDE:s("latitude"),SET_LOCATION_NAME:s("locationName"),SET_LONGITUDE:s("longitude"),SET_MEDIA_URL:s("mediaLink"),SET_PHONE_NUMBER_ID:g,SET_RECIPIENT_NUMBER:s("recipientNumber"),SET_TEMPLATE_NAME:s("templateName"),IF_MEDIA_TEMPLATE:({$:e})=>{var c,i,l;const a=(i=(c=e.getComponent("template-name"))==null?void 0:c.value)==null?void 0:i.split(" ").pop();return d((l=e.getComponent("connection-id"))==null?void 0:l.value)&&a==="IMAGE"||a==="VIDEO"||a==="DOCUMENT"},IF_LOCATION_TEMPLATE:({$:e})=>{var c,i,l;const a=(i=(c=e.getComponent("template-name"))==null?void 0:c.value)==null?void 0:i.split(" ").pop();return d((l=e.getComponent("connection-id"))==null?void 0:l.value)&&a==="LOCATION"},SET_CONNECTION:async({$:e,e:a})=>{s("connectionId")({$:e,e:a}),await r(e)},REFETCH_TEMPLATE:async({$:e})=>{await r(e),e.setComponent("template-name",a=>{e.util.isSelectComponent(a)&&(a.isLoadable=!0)})},ON_MACHINE_LOAD:async({$:e})=>{var a;A(e,[{db:"connectionId",id:"connection-id"},{db:"recipientNumber",id:"recipient-phone-number"},{db:"templateName",id:"template-name"},{db:"mediaLink",id:"media-url"},{db:"longitude",id:"longitude"},{db:"latitude",id:"latitude"},{db:"locationName",id:"location-name"},{db:"address",id:"address"}]),(a=e.db)!=null&&a.connectionId&&await r(e)}}}));export{P as default};
